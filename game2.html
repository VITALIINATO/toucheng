<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Word Building Test</title>
    <style>
        :root {
            --neon-purple: #c700ff;
            --neon-blue: #00f0ff;
            --neon-pink: #ff00c8;
            --neon-green: #00ff44;
            --neon-red: #ff0033;
            --dark-bg: #0a0a0a;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--dark-bg);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        h1 {
            font-size: 2.5rem;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
            margin-bottom: 1rem;
            animation: flicker 2s infinite;
            text-align: center;
            width: 100%;
        }

        #instruction {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: var(--neon-purple);
            text-shadow: 0 0 10px var(--neon-purple);
            min-height: 50px;
        }

        #sentenceContainer,
        #wordBank {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            min-height: 100px;
            width: 90%;
            min-width: 800px;
            margin: 10px auto;
            border: 2px dashed #00aaff;
            background-color: transparent;
            overflow-y: auto;
            border-radius: 10px;
            align-items: center;
        }

        #sentenceContainer {
            border-color: #00ff99;
        }

        .word {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 10px;
            background: #00aaff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            min-width: 50px;
            height: 40px;
            transition: background 0.3s, transform 0.2s;
            font-size: 28px;
        }

        .word:hover {
            background: #007acc;
            transform: scale(1.05);
        }

        .check-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        #checkSentence {
            min-width: 80px;
            min-height: 44px;
            padding: 10px 18px;
            background: #00c853;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s, transform 0.2s;
        }

        #checkSentence:hover {
            background: #00e676;
            transform: scale(1.1);
        }

        #resetButton {
            min-width: 80px;
            min-height: 44px;
            padding: 10px 18px;
            background: #666;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s, transform 0.2s;
        }

        #resetButton:hover {
            background: #888;
            transform: scale(1.1);
        }

        #feedback {
            display: flex;
            justify-content: center;
            padding: 10px 18px;
            min-width: 80px;
            min-height: 24px;
            font-size: 16px;
            font-weight: bold;
            color: #f5f5f5;
            transition: opacity 0.3s ease;
        }

        #timer {
            font-size: 1rem;
            font-weight: bold;
            color: #cccccc;
            text-align: center;
            margin-top: 10px;
        }

        #questionNumber {
            font-size: 1rem;
            font-weight: bold;
            color: #cccccc;
            text-align: center;
            margin-top: 10px;
        }

        #finalResult {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 30px;
            color: #00e676;
            display: none;
            animation: fadeIn 1s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .correct {
            color: #00c853;
        }

        .wrong {
            color: #d50000;
        }

        .time {
            color: #2979ff;
        }

        .glow-word {
            text-shadow: 0 0 10px rgb(0, 110, 255), 0 0 20px rgb(0, 132, 255);
            font-size: 3rem;
            font-weight: bold;
            animation: glow 1s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 10px rgb(0, 153, 255), 0 0 20px rgb(0, 81, 255);
            }

            to {
                text-shadow: 0 0 20px rgb(0, 140, 255), 0 0 40px rgb(0, 153, 255);
            }
        }

        #recordDisplay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
            font-size: 1.2rem;
            color: var(--neon-green);
            text-align: center;
            z-index: 1000;
        }

        #recordDisplay h3 {
            margin: 0 0 10px 0;
            color: var(--neon-pink);
        }

        #recordDisplay p {
            margin: 5px 0;
        }

        #resetRecordsButton {
            margin-top: 15px;
            padding: 8px 16px;
            background: var(--neon-red);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s, transform 0.2s;
        }

        #resetRecordsButton:hover {
            background: #ff3366;
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <p id="questionNumber">Задание 1 из 12</p>
    <h1>Собери слово</h1>
    <div id="gameContainer">
        <p id="timer">Время: 0 секунд</p>
        <p id="instruction"></p>
        <div id="sentenceContainer"></div>
        <div id="wordBank"></div>
        <div class="check-container">
            <button id="checkSentence">Проверить</button>
            <button id="resetButton">Сбросить</button>
        </div>
        <p id="feedback"></p>
    </div>
    <div id="finalResult"></div>
    <audio id="rightSound" src="2right.mp3"></audio>
    <audio id="wrongSound" src="wrong.mp3"></audio>

    <!-- Рекорды -->
    <div id="recordDisplay">
        <h3>Рекорды</h3>
        <p id="bestScore">Лучший результат: 0</p>
        <p id="fastestTime">Лучшее время: Нет данных</p>
        <button id="resetRecordsButton">Сброс рекорда</button>
    </div>

    <script>
        const words = [
            { word: "family", correct: "family", translation: "семья" },
            { word: "relative", correct: "relative", translation: "родственник" },
            { word: "mother", correct: "mother", translation: "мать" },
            { word: "mum", correct: "mum", translation: "мама" },
            { word: "father", correct: "father", translation: "отец" },
            { word: "daddy", correct: "daddy", translation: "папа" },
            { word: "daughter", correct: "daughter", translation: "дочь" },
            { word: "son", correct: "son", translation: "сын" },
            { word: "grandmother", correct: "grandmother", translation: "бабушка" },
               { word: "granny", correct: "granny", translation: "бабуля" },
            { word: "grandfather", correct: "grandfather", translation: "дедушка" },
            { word: "grandpa", correct: "grandpa", translation: "дедуля" },
            { word: "husband", correct: "husband", translation: "муж" },
            { word: "wife", correct: "wife", translation: "жена" },
            { word: "parents", correct: "parents", translation: "родители" },
            { word: "sister", correct: "sister", translation: "сестра" },
            { word: "brother", correct: "brother", translation: "брат" },
            { word: "uncle", correct: "uncle", translation: "дядя" },
            { word: "aunt", correct: "aunt", translation: "тетя" },
            { word: "friend", correct: "friend", translation: "друг" },

        ];

        words.forEach(wordObj => {
            wordObj.letters = wordObj.correct.split('');
        });

        let currentQuestionIndex = 0;
        let scoreWithoutErrors = 0;
        let totalQuestions = 10;
        let testSet = [];
        let startTime = null;
        let timerInterval = null;
        let hasAttempted = false;

        function startTimer() {
            clearInterval(timerInterval);
            if (!startTime) startTime = new Date();
            const timerElement = document.getElementById("timer");
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((new Date() - startTime) / 1000);
                timerElement.textContent = `Время: ${elapsed} секунд`;
            }, 1000);
        }

        function setupGame() {
            const questionNumberEl = document.getElementById("questionNumber");
            const instruction = document.getElementById("instruction");
            const wordBank = document.getElementById("wordBank");
            const sentenceContainer = document.getElementById("sentenceContainer");
            const feedback = document.getElementById("feedback");

            if (currentQuestionIndex >= testSet.length) {
                showFinalResult();
                return;
            }

            const wordObj = testSet[currentQuestionIndex];
            const letters = [...wordObj.letters];
            shuffleArray(letters);
            hasAttempted = false;

            questionNumberEl.textContent = `${currentQuestionIndex + 1} из ${testSet.length}`;
            instruction.textContent = `"${wordObj.translation}"`;
            feedback.textContent = "";
            wordBank.innerHTML = "";
            sentenceContainer.innerHTML = "";

            letters.forEach(letter => {
                const letterEl = document.createElement("span");
                letterEl.className = "word";
                letterEl.textContent = letter;
                letterEl.addEventListener("click", () => {
                    if (letterEl.parentElement === wordBank) {
                        sentenceContainer.appendChild(letterEl);
                    } else {
                        wordBank.appendChild(letterEl);
                    }
                });
                wordBank.appendChild(letterEl);
            });

            document.getElementById("checkSentence").onclick = () => {
                const userWord = Array.from(sentenceContainer.children).map(el => el.textContent).join("");
                const correctWord = wordObj.correct;

                if (userWord === correctWord) {
                    feedback.textContent = "Верно! 👍";
                    feedback.style.color = "#00c853";
                    speak(correctWord);
                    document.getElementById("rightSound").play();

                    Array.from(sentenceContainer.children).forEach((el, i) => {
                        el.classList.remove("letter");
                        el.classList.add("glow-word");
                        el.style.transition = `transform 0.5s ease ${i * 0.1}s`;
                        el.style.transform = "scale(1.5)";
                    });

                    if (!hasAttempted) {
                        scoreWithoutErrors++;
                    }

                    setTimeout(() => {
                        currentQuestionIndex++;
                        setupGame();
                    }, 1500);
                } else {
                    feedback.textContent = "Неверно 👎";
                    feedback.style.color = "#d50000";
                    document.getElementById("wrongSound").play();
                    hasAttempted = true;
                }
            };

            document.getElementById("resetButton").onclick = () => {
                const letters = [...testSet[currentQuestionIndex].letters];
                shuffleArray(letters);
                wordBank.innerHTML = "";
                sentenceContainer.innerHTML = "";
                letters.forEach(letter => {
                    const letterEl = document.createElement("span");
                    letterEl.className = "word";
                    letterEl.textContent = letter;
                    letterEl.addEventListener("click", () => {
                        if (letterEl.parentElement === wordBank) {
                            sentenceContainer.appendChild(letterEl);
                        } else {
                            wordBank.appendChild(letterEl);
                        }
                    });
                    wordBank.appendChild(letterEl);
                });
                feedback.textContent = "";
            };

            startTimer();
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            }
        }

        function showFinalResult() {
            clearInterval(timerInterval);
            const totalTime = Math.floor((new Date() - startTime) / 1000);
            const finalResultDiv = document.getElementById("finalResult");
            const gameContainer = document.getElementById("gameContainer");
            gameContainer.style.display = "none";
            finalResultDiv.style.display = "flex";
            finalResultDiv.style.flexDirection = "column";
            finalResultDiv.innerHTML = `
        <h2 style="color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green);">Тест завершён!</h2>
        <div class="result-item time">Общее время: <span class="time">${totalTime}</span> секунд</div>
        <div class="result-item correct">Без ошибок: <span class="correct">${scoreWithoutErrors}</span></div>
        <div class="result-item wrong">С ошибками: <span class="wrong">${totalQuestions - scoreWithoutErrors}</span></div>
      `;

            updateRecords(scoreWithoutErrors, totalTime);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startTest() {
            const shuffled = [...words].sort(() => Math.random() - 0.5);
            testSet = shuffled.slice(0, totalQuestions);
            currentQuestionIndex = 0;
            scoreWithoutErrors = 0;
            setupGame();
        }

        function updateRecords(score, time) {
            const storedBestScore = localStorage.getItem('bestScore');
            const storedFastestTime = localStorage.getItem('fastestTime');

            let bestScore = storedBestScore ? parseInt(storedBestScore) : 0;
            let fastestTime = storedFastestTime ? parseInt(storedFastestTime) : Infinity;

            if (isNaN(fastestTime)) {
                fastestTime = Infinity;
            }

            // Update best score if current score is better
            if (score > bestScore) {
                localStorage.setItem('bestScore', score);
                bestScore = score;
            }

            // Update fastest time if current time is better
            if (time < fastestTime) {
                localStorage.setItem('fastestTime', time);
                fastestTime = time;
            }

            // Update UI
            document.getElementById('bestScore').textContent = `Лучший результат: ${bestScore}`;

            let timeText;
            if (storedFastestTime === null || isNaN(parseInt(storedFastestTime))) {
                timeText = 'Нет данных';
            } else {
                timeText = `${parseInt(storedFastestTime)} с`;
            }

            document.getElementById('fastestTime').textContent = `Лучшее время: ${timeText}`;
        }

        document.addEventListener("DOMContentLoaded", () => {
            const storedBestScore = localStorage.getItem('bestScore');
            const storedFastestTime = localStorage.getItem('fastestTime');

            // Initialize best score display
            document.getElementById('bestScore').textContent = `Лучший результат: ${storedBestScore || 0}`;

            // Initialize fastest time display
            let fastestTimeDisplay = 'Нет данных';
            if (storedFastestTime && !isNaN(parseInt(storedFastestTime))) {
                fastestTimeDisplay = `${parseInt(storedFastestTime)} с`;
            }
            document.getElementById('fastestTime').textContent = `Лучшее время: ${fastestTimeDisplay}`;

            // Add reset records button listener
            document.getElementById('resetRecordsButton').addEventListener('click', resetRecords);

            // Start the test
            startTest();
        });

        function resetRecords() {
            localStorage.removeItem('bestScore');
            localStorage.removeItem('fastestTime');
            document.getElementById('bestScore').textContent = 'Лучший результат: 0';
            document.getElementById('fastestTime').textContent = 'Лучшее время: Нет данных';
        }

        document.addEventListener("DOMContentLoaded", () => {
            const storedBestScore = localStorage.getItem('bestScore');
            const storedFastestTime = localStorage.getItem('fastestTime');

            document.getElementById('bestScore').textContent = `Лучший результат: ${storedBestScore || 0}`;

            const isTimeValid = storedFastestTime && !isNaN(parseInt(storedFastestTime));
            const fastestTimeDisplay = isTimeValid ? `${parseInt(storedFastestTime)} с` : 'Нет данных';
            document.getElementById('fastestTime').textContent = `Лучшее время: ${fastestTimeDisplay}`;

            document.getElementById('resetRecordsButton').addEventListener('click', resetRecords);
            startTest();
        });
    </script>
</body>

</html>
