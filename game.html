<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Drop Clicker</title>
    <style>
        @keyframes fall {
            from {
                transform: translateY(-10%)
            }

            to {
                transform: translateY(100vh)
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0)
            }

            25% {
                transform: translateX(-5px) rotate(-2deg)
            }

            50% {
                transform: translateX(5px) rotate(2deg)
            }

            75% {
                transform: translateX(-5px) rotate(-2deg)
            }
        }

        @keyframes explosion {
            0% {
                transform: scale(1);
                background: radial-gradient(circle, #ff4444, #cc0000);
                box-shadow: 0 0 20px #ff4444;
            }

            50% {
                transform: scale(2);
                opacity: 0.8;
            }

            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            height: 100vh;
            width: 100%;
        }

        .word {
            position: absolute;
            font-size: 24px;
            padding: 15px 30px;
            background: white;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            animation: fall linear infinite;
            transition: transform 0.2s;
            margin: 25px;
            padding: 15px 25px;
            min-width: 120px;
            text-align: center;
             /* Добавляем минимальные отступы */
    margin: 150px;
    min-width: 120px;
    text-align: center;
        }

        .word:hover {
            transform: scale(1.2);
        }

        .word.explosion {
            animation: explosion 0.5s forwards;
            pointer-events: none;
            color: transparent !important;
            margin: 20px;
        }

        #task {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 24px;
            z-index: 10;
        }

        #pauseButton {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            z-index: 10;
        }

        #hud {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
            z-index: 10;
        }

        #score {
            font-size: 72px;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #timer {
            font-size: 72px;
            color: #FF4500;
            font: bold;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }


        #result {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 48px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 600px) {
            #task {
                font-size: 20px;
                padding: 10px 20px;
            }

            .word {
                font-size: 20px;
                padding: 10px 20px;
            }

            #score,
            #timer {
                font-size: 24px;
            }
        }
    </style>
</head>

<body>
    <div id="task">=></div>
    <div id="pauseButton">⏸ Пауза</div>
    <div id="gameContainer"></div>
    <div id="hud">
        <div id="score">0</div>
        <div id="timer">45</div>
    </div>
    <div id="result"></div>

    <script>
    // Система размещения слов без наложений
const wordPositions = [];
const WORD_HEIGHT = 60; // Высота области для каждого слова

function createWord() {
    const wordData = getRandomWords(2);
    wordData.forEach(data => {
        let wordElement;
        let positionFound = false;
        
        while(!positionFound) {
            const left = Math.random() * (window.innerWidth - 150);
            const top = -Math.random() * window.innerHeight * 0.3;
            
            wordElement = document.createElement('div');
            wordElement.className = 'word';
            wordElement.textContent = data.word;
            wordElement.style.left = left + 'px';
            wordElement.style.top = top + 'px';
            wordElement.style.animationDuration = (wordSpeed / 750) + 's';
            
            // Проверка вертикальных коллизий
            const collision = wordPositions.some(pos => {
                return Math.abs(pos - left) < 150 && 
                       Math.abs(pos - top) < WORD_HEIGHT;
            });

            if(!collision) {
                wordPositions.push(left);
                positionFound = true;
                wordElement.addEventListener('click', () => checkAnswer(wordElement, data.word));
                document.getElementById('gameContainer').appendChild(wordElement);
                fallingWords.push(wordElement);
            } else {
                wordElement.remove();
            }
        }
    });
}

// Очистка позиций при удалении слов
function cleanupPositions() {
    setInterval(() => {
        const currentPositions = Array.from(document.querySelectorAll('.word'))
            .map(word => parseFloat(word.style.left));
        wordPositions = [...new Set(currentPositions)];
    }, 1000);
}

// Обновленная функция checkCollisions
function checkCollisions() {
    const words = document.querySelectorAll('.word:not(.explosion)');
    words.forEach(word => {
        const rect = word.getBoundingClientRect();
        words.forEach(otherWord => {
            if(word === otherWord) return;
            
            const otherRect = otherWord.getBoundingClientRect();
            
            if(rect.top < otherRect.bottom && 
               rect.bottom > otherRect.top &&
               rect.left < otherRect.right &&
               rect.right > otherRect.left) {
                
                // Отодвигаем слова друг от друга
                const dx = (rect.left + rect.width/2) - (otherRect.left + otherRect.width/2);
                const dy = (rect.top + rect.height/2) - (otherRect.top + otherRect.height/2);
                
                const angle = Math.atan2(dy, dx);
                const distance = Math.sqrt(dx*dx + dy*dy);
                const minDistance = 150; // Минимальное расстояние между словами
                
                if(distance < minDistance) {
                    const moveX = Math.cos(angle) * (minDistance - distance);
                    const moveY = Math.sin(angle) * (minDistance - distance);
                    
                    word.style.left = (parseFloat(word.style.left) + moveX) + 'px';
                    word.style.top = (parseFloat(word.style.top) + moveY) + 'px';
                }
            }
        });
    });
}

// Запуск проверок при старте
cleanupPositions();

        // Обновляем функцию при изменении размера окна
        window.addEventListener('resize', () => {
            const words = document.querySelectorAll('.word');
            words.forEach((word, index) => {
                if (index === 0) return;
                const prevWord = words[index - 1];
                const prevRect = prevWord.getBoundingClientRect();
                word.style.left = Math.max(0, Math.random() * (window.innerWidth - 150)) + 'px';
                word.style.top = (prevRect.top - 50 - Math.random() * 100) + 'px';
            });
        });


        const words = [
            { word: "shop", translation: "магазин" },
            { word: "she", translation: "она" },
            { word: "fish", translation: "рыба" },
            { word: "child", translation: "ребенок" },
            { word: "bench", translation: "лавочка" },
            { word: "cherry", translation: "вишня" },
            { word: "thin", translation: "тонкий" },
            { word: "moth", translation: "мотылек" },
            { word: "smith", translation: "кузнец" },
            { word: "alphabet", translation: "алфавит" },
            { word: "jump", correct: "jump", translation: "прыгать" },
            { word: "job", correct: "job", translation: "работа" },
            { word: "jam", correct: "jam", translation: "джем" },
            { word: "hand", correct: "hand", translation: "рука" },
            { word: "home", correct: "home", translation: "дом" },
            { word: "hat", correct: "hat", translation: "шляпа" },
            { word: "we", correct: "we", translation: "мы" },
            { word: "wine", correct: "wine", translation: "вино" },
            { word: "way", correct: "way", translation: "путь" },
            { word: "rabbit", correct: "rabbit", translation: "кролик" },
            { word: "rose", correct: "rose", translation: "роза" },
            { word: "red", correct: "red", translation: "красный" },
            { word: "yellow", correct: "yellow", translation: "желтый" },
            { word: "yes", correct: "yes", translation: "да" },
            { word: "you", correct: "you", translation: "ты" },
            { word: "gym", correct: "gym", translation: "спортзал" },
            { word: "general", correct: "general", translation: "генерал" },
            { word: "gel", correct: "gel", translation: "гель" },

            { word: "quest", correct: "quest", translation: "поиск" },
            { word: "queen", correct: "queen", translation: "королева" },
            { word: "squirrel", correct: "squirrel", translation: "белка" },
            { word: "exit", correct: "exit", translation: "выход" },
            { word: "sex", correct: "sex", translation: "пол" },
            { word: "fox", correct: "fox", translation: "лиса" }
        ];
        
        const collisionMargin = 25; // Минимальное расстояние между словами
        const maxAttempts = 200; // Максимальное количество попыток размещения
        const positionUpdateInterval = 100; // Частота проверки коллизий (мс)


        let score = 0;
        let timeLeft = 45;
        let currentTask;
        let fallingWords = [];
        let gameInterval;
        let timerInterval;
        let isPaused = false;

        // === НАСТРОЙКИ СЛОЖНОСТИ ===
        const wordSpeed = 6000; // Скорость падения слов (в мс)
        const spawnInterval = 5000; // Частота появления новых слов (в мс)

        function startGame() {
            newTask();
            gameInterval = setInterval(createWord, spawnInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function newTask() {
            currentTask = words[Math.floor(Math.random() * words.length)];
            document.getElementById('task').textContent = `${currentTask.translation}`;
        }

        function createWord() {
            const wordData = getRandomWords(2);
            wordData.forEach(data => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word';
                wordElement.textContent = data.word;
                wordElement.style.left = Math.random() * (window.innerWidth - 150) + 'px';
                wordElement.style.animationDuration = (wordSpeed / 750) + 's';
                wordElement.addEventListener('click', () => checkAnswer(wordElement, data.word));
                document.getElementById('gameContainer').appendChild(wordElement);
                fallingWords.push(wordElement);
            });
        }

        function getRandomWords(count) {
            const result = [currentTask];
            while (result.length < count) {
                const randomWord = words[Math.floor(Math.random() * words.length)];
                if (randomWord.word !== currentTask.word && !result.includes(randomWord)) {
                    result.push(randomWord);
                }
            }
            return result.sort(() => 0.5 - Math.random());
        }

        async function checkAnswer(element, word) {
            if (isPaused) return;

            if (word === currentTask.word) {
                element.classList.add('explosion');

                // Озвучка английского слова
                await speak(word);
                playSound('correct');

                setTimeout(() => {
                    element.remove();
                    fallingWords = fallingWords.filter(w => w !== element);
                }, 50);

                score++;
                document.getElementById('score').textContent = score;
                newTask();
            } else {
                element.classList.add('shake');
                setTimeout(() => element.classList.remove('shake'), 100);
                playSound('wrong');
            }
        }

        function updateTimer() {
            timeLeft--;
            document.getElementById('timer').textContent = timeLeft;
            if (timeLeft <= 0) endGame();
        }

        function endGame() {
            clearInterval(gameInterval);
            clearInterval(timerInterval);

            // Удаляем все слова
            fallingWords.forEach(word => word.remove());
            fallingWords = [];

            // Показываем результат
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = `Очки: ${score}`;

            // Добавляем кнопку перезапуска
            const restartButton = document.createElement('button');
            restartButton.textContent = 'Начать заново';
            restartButton.style.marginTop = '20px';
            restartButton.style.padding = '15px 30px';
            restartButton.style.fontSize = '24px';
            restartButton.style.backgroundColor = '#4CAF50';
            restartButton.style.color = 'white';
            restartButton.style.border = 'none';
            restartButton.style.borderRadius = '10px';
            restartButton.style.cursor = 'pointer';
            restartButton.onclick = () => window.location.reload();

            resultDiv.appendChild(restartButton);
            resultDiv.style.display = 'flex';
        }

        // function playSound(type) {
        //     const audio = new Audio(type === 'correct' ? 'right.mp3' : 'wrong.mp3');
        //     audio.volume = 0.3;
        //     audio.play();
        // }

        function speak(word) {
            return new Promise(resolve => {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.onend = resolve;
                speechSynthesis.speak(utterance);
            });
        }

        document.getElementById('pauseButton').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pauseButton').textContent = isPaused ? '▶ Продолжить' : '⏸ Пауза';

            if (isPaused) {
                clearInterval(gameInterval);
                clearInterval(timerInterval);
                fallingWords.forEach(word => word.style.animationPlayState = 'paused');
            } else {
                gameInterval = setInterval(createWord, spawnInterval);
                timerInterval = setInterval(updateTimer, 1000);
                fallingWords.forEach(word => word.style.animationPlayState = 'running');
            }
        });

        startGame();
    </script>
</body>

</html>
